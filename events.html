<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Events - Eventora</title>
  <link rel="stylesheet" href="assets/css/style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
</head>

<body>
  <div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo">Eventora</div>
      <ul>
        <li><a class="active" href="events.html">My Events</a></li>
        <li><a href="reminders.html">Reminders</a></li>
        <li><a href="bookings.html">Bookings</a></li>
        <li><a href="login.html">Logout</a></li>
      </ul>
    </aside>

    <!-- Main Content -->
    <div class="content">
      <div class="page-header">
        <h2>Available Events</h2>
      </div>

      <div id="eventsContainer" class="card-grid">
        <p>Loading events...</p>
      </div>
    </div>
  </div>
  <script src="assets/js/utils.js"></script>

  <!-- JavaScript -->
  <script>
    const token = localStorage.getItem("token"); // Make sure login saves token
    const API_BASE = getAPIUrl();
    async function loadEvents() {
      try {
        const response = await fetch(`${API_BASE}/api/events`, {
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${token}`
          }
        });

        if (!response.ok) {
          document.getElementById("eventsContainer").innerHTML = "<p>Failed to load events.</p>";
          return;
        }

        const events = await response.json();
        const container = document.getElementById("eventsContainer");
        container.innerHTML = "";

        if (events.length === 0) {
          container.innerHTML = "<p>No events available right now.</p>";
          return;
        }

        events.forEach(ev => {
          const start = new Date(ev.startDate).toLocaleDateString("en-US", {
            year: "numeric",
            month: "short",
            day: "numeric"
          });

          const end = new Date(ev.endDate).toLocaleDateString("en-US", {
            year: "numeric",
            month: "short",
            day: "numeric"
          });

          const card = `
            <div class="card">
              <div class="card-body">
                <h3>${ev.title}</h3>
                <p>üìÖ ${start} - ${end}</p>
                <p>üìç ${ev.location}</p>
                <p>üí∞ $${ev.price}</p>
                <button class="btn btn-primary" onclick="viewDetails('${ev._id}')">View Details</button>
              </div>
            </div>
          `;
          container.innerHTML += card;
        });
      } catch (error) {
        console.error("Error fetching events:", error);
        document.getElementById("eventsContainer").innerHTML = "<p>Error loading events.</p>";
      }
    }

    function viewDetails(eventId) {
      localStorage.setItem("selectedEventId", eventId);
      window.location.href = "event-details.html"; // optional details page
    }

    loadEvents();
  </script>
</body>

</html>